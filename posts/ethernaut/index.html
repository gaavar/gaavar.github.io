<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Ethernaut Writeup (Work In Progress) :: Anu Gaavar</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Background and Motivation In case you&amp;rsquo;re wondering what&amp;rsquo;s Ethernaut?
I started this as an excuse to continue exploring EVM engineering and security challenges. My goal for this year is to discover smart contract security bugs in the wild and responsibly disclose them. The real life vulnerabilities are probably more complex but this a fun starting point.
01 - Fallback This was pretty simple. I used the browser developer console for this challenge." />
<meta name="keywords" content=", " />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://gaavar.github.io/posts/ethernaut/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://gaavar.github.io/styles.css">







  <link rel="shortcut icon" href="https://gaavar.github.io/img/theme-colors/blue.png">
  <link rel="apple-touch-icon" href="https://gaavar.github.io/img/theme-colors/blue.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="AGaavar" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Ethernaut Writeup (Work In Progress)">
<meta property="og:description" content="Background and Motivation In case you&amp;rsquo;re wondering what&amp;rsquo;s Ethernaut?
I started this as an excuse to continue exploring EVM engineering and security challenges. My goal for this year is to discover smart contract security bugs in the wild and responsibly disclose them. The real life vulnerabilities are probably more complex but this a fun starting point.
01 - Fallback This was pretty simple. I used the browser developer console for this challenge." />
<meta property="og:url" content="https://gaavar.github.io/posts/ethernaut/" />
<meta property="og:site_name" content="Anu Gaavar" />

  
  
  <meta property="og:image" content="https://gaavar.github.io/">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2023-01-02 00:00:00 &#43;0000 UTC" />












</head>
<body class="blue">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Anu Gaavar
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://gaavar.github.io/posts/ethernaut/">Ethernaut Writeup (Work In Progress)</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2023-01-02 ::
        
      </time>
    
    
      <span class="post-author">Anu Gaavar</span>
    
    
  </div>

  
    <span class="post-tags">
      
      #<a href="https://gaavar.github.io/tags/"></a>&nbsp;
      
      #<a href="https://gaavar.github.io/tags/"></a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h4 id="background-and-motivation">Background and Motivation<a href="#background-and-motivation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>In case you&rsquo;re wondering <a href="https://ethernaut.openzeppelin.com/">what&rsquo;s Ethernaut?</a></p>
<p>I started this as an excuse to continue exploring EVM engineering and security challenges. My goal for this year is to discover smart contract security bugs in the wild and responsibly disclose them. The real life vulnerabilities are probably more complex but this a fun starting point.</p>
<h5 id="01---fallback">01 - Fallback<a href="#01---fallback" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>This was pretty simple. I used the browser developer console for this challenge.</p>
<p>To become the owner of this contract, we need to call <code>receive</code> function which sets the owner.
Since we need to satisfy the <code>require</code> constraints, we must first call <code>contribute</code> with a small matic.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">contribute</span>({<span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">toWei</span>(<span style="color:#e6db74">&#39;0.00001&#39;</span>)})
</span></span></code></pre></div><p>Then, we can assume ownernship with a payload like the one below that satisfies the contraints.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">sendTransaction</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">player</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;contract address&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">toWei</span>(<span style="color:#e6db74">&#39;0.0001&#39;</span>)
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Finally, we drain the wallet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">withdraw</span>()
</span></span></code></pre></div><h5 id="02---fallout">02 - Fallout<a href="#02---fallout" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>This one seemed to be okay at the first glance. But, then the usage of a function as a contructor caught my attention.</p>
<p>So, assuming ownership was very straightfoward.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">Fal1out</span>({<span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">toWei</span>(<span style="color:#e6db74">&#39;0.0000001&#39;</span>)})
</span></span></code></pre></div><h5 id="03---coin-flip">03 - Coin Flip<a href="#03---coin-flip" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>To clear this stage, the coin flip needs to be guesssed correctly straight for 10 times consecutively. The <code>block.number</code> seems to be the source of the pseudo random process which determines the <code>side</code>. It would be difficult to ensure that our transactions are included in particular blocks to ensure correct <code>_guess</code>.</p>
<p>After some research, it became clear to me that an easy way to solve this challenge is to create another smart contract that calls the vulnerable smart contract, passing the computed <code>_guess</code>. Then, solving the challenge is very easy: submit 10 transactions from your smart contract.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/3-coinflip.sol">Here&rsquo;s</a> my contract for reference.</p>
<h5 id="04---telephone">04 - Telephone<a href="#04---telephone" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>To become an owner of this contract, I have to ensure that <code>tx.origin</code> is not the same as <code>msg.sender</code>.</p>
<p>The key insight for this is explained in <a href="https://ethereum.stackexchange.com/questions/1891/whats-the-difference-between-msg-sender-and-tx-origin">this stackoverflow post</a>!</p>
<p>And so, I just made a contract with a function to call the vulnerable contract such that the <code>tx.origin</code> is my externally owned account and the <code>msg.sender</code> is my contract.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/4-telephone.sol">Here&rsquo;s</a> my contract for reference.</p>
<h5 id="05---token">05 - Token<a href="#05---token" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>The goal here is to get more tokens than what you originally have. It was easy to spot that <code>uint</code> can overflow since it has a range from 0 to 2^256-1.</p>
<p>So any number greater than 20 will result in the <code>require</code> statement to evaluate the resulant number on that range in a circular fashion.</p>
<p>Then the next line in the vulnerable contract will just increase my address balance.</p>
<p>Here&rsquo;s a sample payload:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">transfer</span>(<span style="color:#e6db74">&#34;0xdE245C9453c5DC631b83fC417154950bEE7cA676&#34;</span>, <span style="color:#ae81ff">21</span>);
</span></span></code></pre></div><h5 id="06---delegation">06 - Delegation<a href="#06---delegation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>The key insight into this challenge is to understand the <code>fallback</code> &amp; <code>delegatecall</code> functions.</p>
<p>The fallback in solidity is designed to handle cases when someone calls a method on smart contract that is not defined. More specifically, fallback gets triggered when the function selector doesn&rsquo;t match with any of the function selectors for the methods available on a contract.</p>
<p>Inside the fallback function of the vulnerable smart contract, <code>delegatecall</code> allows <code>Delegate</code> to use the logic contained withing it to modify the state of <code>Delegation</code>. Side note: this functionality is key to developing upgradeable smart contracts.</p>
<p>And so in this case, all I needed was to trigger the fallback function in such a way that the call to <code>pwn</code> is delegated to <code>Delegate</code> which should change the <code>owner</code> variable of the <code>Delegation</code> contract.</p>
<p>Here&rsquo;s how I accomplished this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">sendTransaction</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">player</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">abi</span>.<span style="color:#a6e22e">encodeFunctionSignature</span>(<span style="color:#e6db74">&#34;pwn()&#34;</span>)
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Since <code>pwn</code> is not defined in <code>Delegation</code>, <code>fallback</code> picks this request and asks <code>Delegate</code> to deal with this call. <code>pwn</code> is defined in <code>Delegate</code> which changes <code>Delegation</code>&rsquo;s  <code>owner</code> value.</p>
<h5 id="07---force">07 - Force<a href="#07---force" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>The challenge here is to send money to a contract that doesn&rsquo;t contain a payable method or a receieve function.</p>
<p>I looked up the (solidity language reference)[https://docs.soliditylang.org/en/latest/contracts.html] and found the key insight:</p>
<pre tabindex="0"><code>A contract without a receive Ether function can receive Ether as a recipient
of a coinbase transaction (aka miner block reward) or as a destination of a
selfdestruct.
</code></pre><p>The first option would be an overkill since we would need to setup a mining client and mine transactions. I used the second option to create an attack smart contract that receives money through a payable method and calls selfdestruct.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/7-force.sol">Here&rsquo;s</a> my contract for reference.</p>
<p>After deploying the contract, I called the payable function with some money.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">sendTransaction</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">player</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&lt;my contract address&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">toWei</span>(<span style="color:#e6db74">&#39;0.00001&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">abi</span>.<span style="color:#a6e22e">encodeFunctionSignature</span>(<span style="color:#e6db74">&#34;sendSchmoney()&#34;</span>)
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h5 id="08---vault">08 - Vault<a href="#08---vault" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>ToDo</p>
<h5 id="09---king">09 - King<a href="#09---king" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>In this challenge, the objective is to make the value of <code>king</code> immutable. Essentially, I need to break the logic that makes the <code>receive</code> function refund the previous king when an amount greater than or equal to <code>prize</code> is sent.</p>
<p>I noticed the <code>transfer</code> function. As I had learned earlier in Force, the <code>transfer</code> will fail if the contract doesn&rsquo;t implement a <code>receieve</code> or a payable fallback function. So, I decided to create a contract that would forward any money it receives to the vulnerable contract and become the king. The attack contract itself can&rsquo;t receieve ether through the vulnerable contract (since it dosen&rsquo;t have a <code>selfdestruct</code>). So any further calls to outbid will revert because the <code>transfer</code> won&rsquo;t work.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/9-king.sol">Here&rsquo;s</a> my contract for reference.</p>
<p>After deploying this contract, I sent money to one of its payable methods made my contract the king permanently.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">sendTransaction</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">player</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&lt;my contract address&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">toWei</span>(<span style="color:#e6db74">&#39;0.02&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">abi</span>.<span style="color:#a6e22e">encodeFunctionSignature</span>(<span style="color:#e6db74">&#34;claimKingship()&#34;</span>)
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>After completing this challenge, I actually learnt more about its depth and the lessons to be learnt from reading further.</p>
<p>Specifically, I learnt that <code>send</code> doesn&rsquo;t revert on failures while <code>transfer</code> does. Both of them use fix amount of gas which is okay to protect against reentracy attack. However, their usage opens doors for another problem: fixed gas may not be sufficient to succesfully send money to contracts with complex logic.</p>
<p>I also learnt more about better patterns to use when writing contracts to send &amp; receive money.</p>
<p><a href="https://web.archive.org/web/20220122122006/https://consensys.github.io/smart-contract-best-practices/recommendations/">Reference 1. Sections: Don&rsquo;t use transfer() or send() + Favor pull over push for external calls</a></p>
<p><a href="https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/">Reference 2. Stop Using Solidity&rsquo;s transfer() Now </a></p>
<h5 id="10---re-entrancy">10 - Re-entrancy<a href="#10---re-entrancy" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>The challenge here was to reduce the balance of <code>Reentrance</code> contract to zero.</p>
<p>Given the popularity of the re-entrancy attacks, I knew exactly what to do: create a smart contract that receives money, <code>donate</code> it to the vulnerable contract and then call <code>withdraw</code>. In addition, I created a <code>receive</code> function which would transfer the amount back to me and call <code>withdraw</code> again creating a cycle where I would keep receieving money in small amounts until the contract&rsquo;s balance is zero.</p>
<p>For me, the hard part was figuring out how to call the <code>Reentrance</code>&rsquo;s methods inside my contract without importing the contract since it was using an old solidity compiler with old <code>SafeMath</code> library which I assumed would be tricky to import/locate. And so, I attempted to use low level functions such as <code>abi.encodeWithSignature</code> and <code>call</code> but encountered issues which would revert my calls to <code>withdraw</code>. So, I went reconsidered importing contracts and it worked just fine!</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/10-reentrancy.sol">Here&rsquo;s</a> my contract for reference.</p>
<h5 id="11---elevator">11 - Elevator<a href="#11---elevator" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>In this challenge, we need to set the <code>top</code> to <code>true</code>. The contract called inside <code>goTo</code> function (i.e the contract that calls this function) should implement the interface of the building.</p>
<p>And so, I created a contract that would alternate between returning false and true for <code>isLastFloor</code> and hence would set the <code>top</code> variable.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/11-elevator.sol">Here&rsquo;s</a> my contract for reference.</p>
<p>After deploying the contract, I called the <code>setTopFloor</code> using Remix.</p>
<h5 id="12---privacy">12 - Privacy<a href="#12---privacy" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>For this challenge, I need to provide the correct <code>_key</code> that would unlock the contract. Since blockchain data is public, stored values in deployed contracts are readable.</p>
<p>In this case, I decided to skim <a href="https://docs.soliditylang.org/en/v0.8.17/internals/layout_in_storage.html">Layout of State Variables in Storage</a> for solidity before proceeding further.</p>
<p>I guessed that <code>locked</code> will be in storage slot 0. <code>ID</code> will go in slot 1 as it can&rsquo;t be packed fit inside slot 0. <code>flattening</code>, <code>denomination</code>, and <code>awkwardness</code> should be in storage slot 2 as their combined data size is less than 32 bytes. Then, each of the element of <code>data</code> array would be in its own slot. So, <code>data[0]</code> in slot 3, <code>data[1]</code> in slot 4, and <code>data[2]</code> in slot 5.</p>
<p>I extracted the slot 5 value like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data2</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">web3</span>.<span style="color:#a6e22e">eth</span>.<span style="color:#a6e22e">getStorageAt</span>(<span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">address</span>, <span style="color:#ae81ff">5</span>);
</span></span></code></pre></div><p>After this, I noticed the explicit conversion of <code>data[2]</code> from <code>bytes32</code> to <code>bytes16</code>. This means that I would need the first half of the value of <code>data[2]</code>. I read about type casting in solidity doc&rsquo;s <a href="https://docs.soliditylang.org/en/v0.8.17/types.html#explicit-conversions">Explicit Conversions</a>.</p>
<p>Here&rsquo;s my payload to unlock the contract:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">data2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data2</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">2</span>,); <span style="color:#75715e">// removing the 0x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0x&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">data2</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">data2</span>.<span style="color:#a6e22e">length</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>); <span style="color:#75715e">// getting the first half bytes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">unlock</span>(<span style="color:#a6e22e">key</span>);
</span></span></code></pre></div><h5 id="13---gatekeeper-one">13 - Gatekeeper One<a href="#13---gatekeeper-one" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>I found this one particularly challenging. The challenge is to circumvent through 3 different gates present as function modifiers.</p>
<p>To pass <code>gateOne</code>, I needed to create a contract that calls <code>enter</code>. This way <code>tx.origin</code> would be my externally owned acccount and the <code>msg.sender</code> would be my contract.</p>
<p>To pass <code>gateThree</code>, I decided to craft the <code>_gateKey</code> by examining <code>require</code> statements bottom to top. I also found <a href="https://github.com/tintinweb/solidity-shell">solidity-shell</a> which was very helpful in creating a payload.</p>
<p>With solidity-shell, here&rsquo;s how I created the key:</p>
<pre tabindex="0"><code>address a = &lt;my-address&gt;;
uint16 b = uint16(uint160(a));
uint64 c = b; // to satisfy the 1st and 3rd require conditions
bytes8 d = bytes8(c); // change the leading zero of d to some value
</code></pre><p>If it&rsquo;s not clear, I first obtained the uint16 value for <code>uint16(uint160(tx.origin))</code> as <code>b</code>. I converted <code>b</code> to uint64 which would be the same number and casted it as bytes8. When <code>uint</code>are casted from a high bit to low bit uint type, the higher order bits are cut off. When <code>d</code> is casted to <code>bytes32</code>, <code>bytes16</code> and <code>bytes64</code>, values would be equal. But as per the 2nd require condition, we want <code>uint64</code> and <code>uint32</code> values to be different. To accomplish this, I changed the first leading zero of our payload in <code>d</code> to <code>1</code>.</p>
<p>To pass <code>gateTwo</code>, I wanted to compute the gas that gets used leading up to the call to <code>gasLeft()</code>. I couldn&rsquo;t find a clear way to compute that in Remix or other tools. So, I decided to create a loop inside my attack contract which would brute force past the <code>gateTwo</code> by trying different gas units.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/13-gatekeeperone.sol">Here&rsquo;s</a> my contract for reference.</p>
<h5 id="14---gatekeeper-two">14 - Gatekeeper Two<a href="#14---gatekeeper-two" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>This challenge has the same format as the previous one.</p>
<p>For <code>gateOne</code>, I created another smart contract which would call <code>enter</code> method.</p>
<p>In <code>gateTwo</code>, I noticed <code>extcodesize</code> which is used to return the size of another smart contract. But as discussed in this <a href="https://ethereum.stackexchange.com/questions/15641/how-does-a-contract-find-out-if-another-address-is-a-contract">stackoverflow post</a>, <code>extcodesize</code> returns 0 when called from a contract&rsquo;s constructor. This meant that the call <code>enter</code> should be inside the constructor of the contract.</p>
<p>Finally for <code>gateThree</code>, we can compute <code>_gateKey</code> as <code>bytes8 gateKey = bytes8(type(uint64).max ^ uint64(bytes8(keccak256(abi.encodePacked(address(this))))));</code> in Solidity. This is because if A XOR B = C, then B = C XOR A.</p>
<p><a href="https://github.com/gaavar/anu-x-ethernaut/blob/main/14-gatekeepertwo.sol">Here&rsquo;s</a> my contract for reference.</p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="https://gaavar.github.io/posts/readlist/">
                <span class="button__text">Reading List</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© <a href="https://github.com/gaavar">Anu Gaavar</a></span>
    
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
